platform :ios, '16.0'
use_frameworks!
inhibit_all_warnings!

target 'SkinCrafter' do
  # Google Mobile Ads SDK for COPPA-compliant advertising
  pod 'Google-Mobile-Ads-SDK'
  
  # Optional: Analytics (ensure COPPA compliance settings)
  # pod 'Firebase/Analytics'
  
  # Optional: In-app purchases for premium features
  # pod 'SwiftyStoreKit', '~> 0.16'
end

post_install do |installer|
  # Fix Xcode 15+ script sandboxing issues
  installer.generated_projects.each do |project|
    project.targets.each do |target|
      target.build_configurations.each do |config|
        config.build_settings['ENABLE_USER_SCRIPT_SANDBOXING'] = 'NO'
      end
    end
  end
  
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '16.0'
      config.build_settings['ENABLE_USER_SCRIPT_SANDBOXING'] = 'NO'
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES'
      
      # Fix framework search paths
      config.build_settings['FRAMEWORK_SEARCH_PATHS'] ||= ['$(inherited)']
      config.build_settings['LD_RUNPATH_SEARCH_PATHS'] ||= ['$(inherited)']
      
      # Ensure proper linking
      config.build_settings['OTHER_LDFLAGS'] ||= ['$(inherited)']
      
      # Enable child-directed treatment for all ad requests
      config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']
      config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'CHILD_DIRECTED_TREATMENT=1'
    end
  end
end